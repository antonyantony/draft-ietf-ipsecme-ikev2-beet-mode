<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>A Bound End-to-End Tunnel (BEET) mode for ESP</title>
<meta content="Antony Antony" name="author">
<meta content="Steffen Klassert" name="author">
<meta content="
       
    This document specifies a new mode for IPsec ESP, known as Bound
 End-to-End Tunnel (BEET) mode. This mode complements the existing ESP tunnel
 and transport modes, while enhancing end-to-end IPsec usage. It offers the
 characteristics of the tunnel mode but without its usual overhead. The BEET
 mode is designed to accommodate evolving applications of ESP, such as
 minimalist end-to-end tunnel, mobility and multi-address multi-homing.
 Additionally, this document proposes a new Notify Message, USE_BEET_MODE, for the
 Internet Key Exchange Protocol Version 2 (IKEv2) specified in
  , to facilitate BEET mode Security Association
 negotiation.
       
    " name="description">
<meta content="xml2rfc 3.18.2" name="generator">
<meta content="IKEv2" name="keyword">
<meta content="BEET" name="keyword">
<meta content="draft-antony-ipsecme-beet-mode-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.9.16
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 3.11.0
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 58.1.0
    six 1.16.0
    wcwidth 0.2.8
    weasyprint 60.1
-->
<link href="/a/www/www6s/staging/draft-antony-ipsecme-beet-mode-00.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef,
.iref + a[href].internal {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body class="xml2rfc">
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">BEET mode for ESP</td>
<td class="right">October 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Antony &amp; Klassert</td>
<td class="center">Expires 25 April 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">IPSECME Working Group</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-10-23" class="published">23 October 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-04-25">25 April 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. Antony</div>
<div class="org">secunet</div>
</div>
<div class="author">
      <div class="author-name">S. Klassert</div>
<div class="org">secunet</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">A Bound End-to-End Tunnel (BEET) mode for ESP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
    This document specifies a new mode for IPsec ESP, known as Bound
 End-to-End Tunnel (BEET) mode. This mode complements the existing ESP tunnel
 and transport modes, while enhancing end-to-end IPsec usage. It offers the
 characteristics of the tunnel mode but without its usual overhead. The BEET
 mode is designed to accommodate evolving applications of ESP, such as
 minimalist end-to-end tunnel, mobility and multi-address multi-homing.
 Additionally, this document proposes a new Notify Message, USE_BEET_MODE, for the
 Internet Key Exchange Protocol Version 2 (IKEv2) specified in
 <span>[<a href="#RFC7296" class="cite xref">RFC7296</a>]</span>, to facilitate BEET mode Security Association
 negotiation.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 25 April 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-requirements-language" class="internal xref">Requirements Language</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-background" class="internal xref">Background</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-related-work" class="internal xref">Related work</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-use-scenarios" class="internal xref">Use scenarios</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-minimal-ipsec-for-end-to-en" class="internal xref">Minimal IPsec for end-to-end</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-nat-traversal" class="internal xref">NAT traversal</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-end-node-multi-address-mult" class="internal xref">End-node multi-address multi-homing</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-protocol-definition" class="internal xref">Protocol Definition</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-changes-to-security-associa" class="internal xref">Changes to Security Association data structure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-packet-format" class="internal xref">Packet format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-inner-ipv4-datagram" class="internal xref">Inner IPv4 Datagram</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-inner-ipv6-datagram" class="internal xref">Inner IPv6 Datagram</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-cryptographic-processing" class="internal xref">Cryptographic processing</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-ip-header-processing" class="internal xref">IP header processing</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-handling-of-outgoing-packet" class="internal xref">Handling of outgoing packets</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-handling-of-incoming-packet" class="internal xref">Handling of incoming packets</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-ipv4-pseudo-header" class="internal xref">IPv4 Pseudo Header</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-ipv4-inner-fragments" class="internal xref">IPv4 Inner Fragments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-ipv6-inner-fragments" class="internal xref">IPv6 inner Fragments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-mixed-family-ipv4-inside-an" class="internal xref">Mixed family IPv4 inside and IPv6 outside</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-mixed-family-ipv6-inside-an" class="internal xref">Mixed family IPv6 inside and IPv4 outside</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>. <a href="#name-policy-considerations" class="internal xref">Policy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="auto internal xref">15</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-16" class="auto internal xref">16</a>. <a href="#name-ikev2-negotiation" class="internal xref">IKEv2 Negotiation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#section-16.1" class="auto internal xref">16.1</a>.  <a href="#name-use_beet_mode-notify-messag" class="internal xref">USE_BEET_MODE Notify Message Payload</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#section-17" class="auto internal xref">17</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#section-18" class="auto internal xref">18</a>. <a href="#name-implementation-status" class="internal xref">Implementation Status</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.1">
                <p id="section-toc.1-1.18.2.1.1"><a href="#section-18.1" class="auto internal xref">18.1</a>.  <a href="#name-linux-xfrm" class="internal xref">Linux XFRM</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.2">
                <p id="section-toc.1-1.18.2.2.1"><a href="#section-18.2" class="auto internal xref">18.2</a>.  <a href="#name-strongswan" class="internal xref">strongSwan</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18.2.3">
                <p id="section-toc.1-1.18.2.3.1"><a href="#section-18.3" class="auto internal xref">18.3</a>.  <a href="#name-iproute2" class="internal xref">iproute2</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#section-19" class="auto internal xref">19</a>. <a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#section-20" class="auto internal xref">20</a>. <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.21">
            <p id="section-toc.1-1.21.1"><a href="#section-21" class="auto internal xref">21</a>. <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.22">
            <p id="section-toc.1-1.22.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-additional-stuff" class="internal xref">Additional Stuff</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.23">
            <p id="section-toc.1-1.23.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
   The current IPsec ESP specification <span>[<a href="#RFC4303" class="cite xref">RFC4303</a>]</span> defines two
  modes of operation: the tunnel mode and the transport mode.  The tunnel mode is mainly
   intended for non-end-to-end use where one or both of the ends of the
   ESP Security Associations (SAs) are located in security gateways,
   separate from the actual IPsec end-nodes.  The transport mode is intended
   for end-to-end use, where both ends of the Security Association are
   terminated at the end-nodes themselves.

   This document defines a new mode for ESP, called Bound End-to-End
   Tunnel (BEET) mode.  The purpose of the BEET mode is to provide limited
   tunnel mode semantics without the overhead associated with the
   regular tunnel mode.  As the name states, the BEET mode is intended
   solely for end-to-end use.  It provides tunnel mode semantics in the
   sense that the IP addresses seen by the applications and the IP
   addresses used on the wire are distinct from each other, providing
   the illusion that the application-level IP addresses are tunneled
   over the network-level IP addresses.  However, the BEET mode does not
   support full tunnel semantics.  More specifically, the IP addresses as seen
  by the application are strictly bound. In BEET mode, only a pair of addresses
  is negotiated, and only this pair of strictly bound inner addresses MUST be
  used within a given BEET mode Security Association. This is in contrast to
  the regular tunnel mode, where an IP address range, source range and
  destination range, can be negotiated, and the inner IP addresses can be any
  pair of IP addresses within the negotiated IP address range.

   A BEET mode Security Association records two pairs of IP addresses,
   called inner addresses and outer addresses. The inner addresses are
   what the applications see.  The outer addresses are what appears on
   the wire.  Since the inner addresses are fixed for the lifetime of
   the Security Association, they need not be sent in each
   packet.  Instead, they are set up as the Security Associations are
   created, they are verified when packets are sent, and they are
   restored as packets are received.

   This all gives BEET mode the efficiency of transport mode with a
   limited set of end-to-end tunnel semantics. The increase efficiency is
   accomplished by removing the inner IP header from the packet that is
   transported on the wire. Due to this removal of the inner IP header, the TTL
   of a tunneled packet is reduced at every router on the path as the TTL
   value is copied from inner to outer header by the sender and vice
   versa by the receiver.  The semantics of BEET mode is limited in the
   sense that only one fixed pair of inner addresses is allowed.  The
   outer addresses may change over the lifetime of the SA, but the
   inner addresses cannot.  If a new pair of inner addresses is needed,
   a new BEET mode Security Association must be established.
  In the cases considered here, a single pair of security associations between any
  single pair of nodes is usually sufficient.<a href="#section-1-1" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
       "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
       document are to be interpreted as described in
  <span><a href="#RFC2119" class="internal xref">RFC 2119</a> [<a href="#RFC2119" class="cite xref">RFC2119</a>]</span>.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">
       In this section we define terms specific to this document. This section
  is normative.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-2.1"> Inner IP address :
      An IP address as seen by applications, typically stored in TCP or other
      upper layer data structures. It is processed by the IP stack prior
      to ESP processing in the output side and after ESP processing in
      the input side.<a href="#section-1.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.2">
      Outer IP address: An IP address seen on the wire and processed by the IP
 stack after ESP processing in the output side and before ESP processing
 in the input side.<a href="#section-1.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.3">
      Inner IP header: An IP header that contains inner IP addresses.  In some cases an
      inner IP header may be represented as an internal data structure
      containing data equivalent to an IP header.<a href="#section-1.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.4">
      Outer IP header: An IP header that contains outer IP addresses.  In some cases an
      outer IP header may be represented as an internal data structure
      containing the data equivalent to an IP header.<a href="#section-1.2-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</section>
<div id="Background">
<section id="section-2">
      <h2 id="name-background">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-background" class="section-name selfRef">Background</a>
      </h2>
<p id="section-2-1">
For years, the idea of a minimal IPsec tunnel mode for end-to-end security has
sparked discussions and innovation. BEET mode has been in use for over a decade.
It hs the potential to improve secure data transmission. Once BEET mode is
standardized its potential for enhancing secure communications would increase
with interoperablity.<a href="#section-2-1" class="pilcrow">¶</a></p>
<div id="Related">
<section id="section-2.1">
        <h3 id="name-related-work">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-related-work" class="section-name selfRef">Related work</a>
        </h3>
<p id="section-2.1-1">
  The basic idea captured by this draft has been floating around for a
  long time. Steven Bellovin's HostNAT talk [8] and at the Los Angeles IETF
  is an early example, and this ID is based on BEET mode ID
  <span>[<a href="#I-D.nikander-esp-beet-mode" class="cite xref">I-D.nikander-esp-beet-mode</a>]</span>. The same idea has surfaced
  several times. Perhaps the most concrete current proposal is the Host
  Identity Protocol (HIP) <span>[<a href="#RFC5201" class="cite xref">RFC5201</a>]</span> and <span>[<a href="#RFC5202" class="cite xref">RFC5202</a>]</span>
  where BEET-mode ESP processing is an integral part of the overall protocol
  without IKE negotiation. The updated version of the Host Identity Protocol
  (HIPv2) <span>[<a href="#RFC7401" class="cite xref">RFC7401</a>]</span> and <span>[<a href="#RFC7402" class="cite xref">RFC7402</a>]</span> recommend the
  use of BEET mode.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">
 Minimal ESP <span>[<a href="#RFC9333" class="cite xref">RFC9333</a>]</span> can also benefit from the use BEET mode.
  It reduces the outter packet size by 20 - 40 bytes per packet, by ommiting
 inner IPv4/IPv6 header, compared to tunnel mode.
 However <span>[<a href="#RFC9333" class="cite xref">RFC9333</a>]</span> did not recommend the use of BEET mode, as
 it is not yet standardized<a href="#section-2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Use">
<section id="section-3">
      <h2 id="name-use-scenarios">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-use-scenarios" class="section-name selfRef">Use scenarios</a>
      </h2>
<p id="section-3-1">
  In this section we describe a number of possible use scenarios. None of
  these scenarios are meant to be complete specifications on how exactly
  to support the functionality. Separate specifications are needed for
  that. Instead, the purpose of this section is to discuss the overall
  benefits of BEET mode, and to lay out a road map for possible future
  documents. This section is informative.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="IPsec-minimal">
<section id="section-3.1">
        <h3 id="name-minimal-ipsec-for-end-to-en">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-minimal-ipsec-for-end-to-en" class="section-name selfRef">Minimal IPsec for end-to-end</a>
        </h3>
<p id="section-3.1-1">
Over the years, BEET-mode has been widely adopted as a minimal IPsec tunnel
for end-to-end scenarios, effectively reducing data transmission over
the wire. It also helps alleviate MTU issues.
Additionally, BEET is valuable for low-power devices, as it reduces
power consumption <span>[<a href="#RFC9333" class="cite xref">RFC9333</a>]</span> and complexity. In situations where devices
or IPsec connections are dedicated to a single application or transport protocol,
BEET mode simplifies packet processing and conserves energy, especially for
lower-powered devices.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="NAT-T">
<section id="section-3.2">
        <h3 id="name-nat-traversal">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-nat-traversal" class="section-name selfRef">NAT traversal</a>
        </h3>
<p id="section-3.2-1">
   NAT traversal is currently a major issue in IPsec. Encapsulating packets into
  UDP using
   Transport mode may suffice in some cases, but it becomes inadequate when
  multiple clients are behind a NAT gateway. In such situations, tunnel mode
  becomes necessary.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">
   BEET mode offers tunnel mode semantics without the additional packet overhead
  associated with traditional tunnel mode when operating behind a NAT gateway.
  A pair of BEET-mode Security Associations (SAs) can effectively "un-NAT"
  packets originationg from behind a NAT gatewa as they traverse the network.
  [AA do we need this ?? This process is illustrated in Figure 1.]<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3"> [SK: The figure and the comments from the old draft is missing here.
   Is the scenario where a client behind NAT knows it's public address
   common? Maybe ask Pablo.]<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="End-node-multihome">
<section id="section-3.3">
        <h3 id="name-end-node-multi-address-mult">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-end-node-multi-address-mult" class="section-name selfRef">End-node multi-address multi-homing</a>
        </h3>
<p id="section-3.3-1">
   BEET mode enables limited end-node multi-address multi-homing. It
   establishes a tunnel between end-hosts with fixed inner IP addresses,
   allowing multi-homed hosts to use different outer IP addresses in
   various packets without impacting upper-layer protocols.

   Upper-layer protocols consistently see the inner IP address, ensuring
   seamless communication over fixed IP addresses.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">

   Implementing this kind of limited multi-homing support would require
   a small change to the current IPsec SPD and SA implementations.
   Currently the incoming SA selection is based on the SPI and
   destination address, with the implicit assumption that there is only
   one possible destination address for each incoming SA.  In a multi-
   homed host it would be desirable to have multiple destination
   addresses associated with the SA, thereby allowing the same SA to be
   used independent on the actual destination address in the packets.
   Removing the destination address from unicast SA lookup is already
   being proposed in the current ESP <span>[<a href="#RFC4303" class="cite xref">RFC4303</a>]</span>. [AA verify this part]<a href="#section-3.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Protocol-definition">
<section id="section-4">
      <h2 id="name-protocol-definition">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-protocol-definition" class="section-name selfRef">Protocol Definition</a>
      </h2>
<p id="section-4-1">
   In this section we define the exact protocol formats and operations. This section is normative.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="Changes-SA">
<section id="section-4.1">
        <h3 id="name-changes-to-security-associa">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-changes-to-security-associa" class="section-name selfRef">Changes to Security Association data structure</a>
        </h3>
<p id="section-4.1-1">
   A BEET mode Security Association contains the same data as a regular
   tunnel mode Security Association, with the exception that the inner
   selectors must be single addresses and cannot be subnets.  The data
   includes the following:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1"> A pair of inner IP addresses.<a href="#section-4.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-2.2"> A pair of outer IP addresses.<a href="#section-4.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-2.3"> Cryptographic keys and other data as defined in <span>[<a href="#RFC4301" class="cite xref">RFC4301</a>]</span> Section 4.4.2.<a href="#section-4.1-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-3"> A conforming implementation MAY store the data in a way similar to a
   regular tunnel mode Security Association.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">
   Note that in a conforming implementation, the inner and outer
   addresses MAY belong to different address families. All
   implementations that support both IPv4 and IPv6 SHOULD support both
   IPv4-over-IPv6 and IPv6-over-IPv4 tunneling.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Packet-format">
<section id="section-4.2">
        <h3 id="name-packet-format">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-packet-format" class="section-name selfRef">Packet format</a>
        </h3>
<p id="section-4.2-1">
   The wire packet format is identical to the ESP transport mode wire
   format as defined in  <span>[<a href="#RFC4303" class="cite xref">RFC4303</a>]</span> Section 3.1.1.  However,
  the resulting packet contains outer IP addresses instead of the inner IP addresses
   received from the upper layer.  The construction of the outer headers
   is defined in <span>[<a href="#RFC4301" class="cite xref">RFC4301</a>]</span> Section 5.1.2.  The following diagrams
   illustrates ESP BEET mode positioning for typical IPv4 and IPv6
   packets.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">[SK: The figures are not consistent. Let's discuss this in a call.
   Why is dest opts. in IPv6 encrypted, but other ext hdrs are not?<a href="#section-4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="InnerIPv4">
<section id="section-4.3">
        <h3 id="name-inner-ipv4-datagram">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-inner-ipv4-datagram" class="section-name selfRef">Inner IPv4 Datagram</a>
        </h3>
<span id="name-ipv4-inner-datagram-before-"></span><div id="inneripv4before">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-4.3-1.1">
<pre>
    +-----------------------------+
    | inner IP hdr  | TCP | Data  |
    +-----------------------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-ipv4-inner-datagram-before-" class="selfRef">IPv4 INNER DATAGRAM BEFORE APPLYING ESP</a>
          </figcaption></figure>
</div>
<span id="name-after-applying-esp-outer-v4"></span><div id="afterespouteripv4">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-4.3-2.1">
<pre>
    +--------------------------------------------------+
    | outer IP hdr  |     |     |      |   ESP   | ESP |
    | (any options) | ESP | TCP | Data | Trailer | ICV |
    +--------------------------------------------------+
                          |&lt;---- encryption ----&gt;|
                    |&lt;-------- integrity -------&gt;|
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-after-applying-esp-outer-v4" class="selfRef">AFTER APPLYING ESP, OUTER v4 ADDRESSES</a>
          </figcaption></figure>
</div>
<span id="name-after-applying-esp-outer-v6"></span><div id="afterespouteripv6">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-4.3-3.1">
<pre>
    +------------------------------------------------------+
    | outer    | new ext |     |     |      |  ESP   | ESP |
    | IPv6 hdr | hdrs.   | ESP | TCP | Data | Trailer| ICV |
    +------------------------------------------------------+
                               |&lt;--- encryption ----&gt;|
                         |&lt;------ integrity --------&gt;|
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-after-applying-esp-outer-v6" class="selfRef">AFTER APPLYING ESP, OUTER v6 ADDRESSES</a>
          </figcaption></figure>
</div>
<span id="name-ipv4-inner-datagram-with-ip"></span><div id="ipv4inneroptions">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.3-4.1">
<pre>
    +----------------------------+
    | inner IP hdr  |     |      |
    |  + options    | TCP | Data |
    +----------------------------+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-ipv4-inner-datagram-with-ip" class="selfRef">IPv4 INNER DATAGRAM with IP options BEFORE APPLYING ESP</a>
          </figcaption></figure>
</div>
<span id="name-ipv4-after-applying-esp-out"></span><div id="ipv4outeroptions">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-4.3-5.1">
<pre>
    +------------------------------------------------------------+
    | outer IP hdr  |     | PH      |     |      |   ESP   | ESP |
    | (any options) | ESP | Options | TCP | Data | Trailer | ICV |
    +------------------------------------------------------------+
                          |&lt;------- encryption -----------&gt;|
                    |&lt;----------- integrity --------------&gt;|
                        PH = BEET mode Pseudo-Header
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-ipv4-after-applying-esp-out" class="selfRef">IPv4 AFTER APPLYING ESP, OUTER v4 ADDRESSES INNER IPv4 OPTIONS</a>
          </figcaption></figure>
</div>
<span id="name-ipv4-options-after-applying"></span><div id="ipv6outeroptions">
<figure id="figure-6">
          <div class="alignLeft art-text artwork" id="section-4.3-6.1">
<pre>

    +---------------------------------------------------------------+
    | outer  | new ext |     | PH       |     |      |  ESP   | ESP |
    | IP hdr | hdrs.   | ESP | Options  | TCP | Data | Trailer| ICV |
    +---------------------------------------------------------------+
                             |&lt;------ encryption ------------&gt;|
                       |&lt;---------- integrity ---------------&gt;|

                               PH = BEET mode Pseudo-Header

</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-ipv4-options-after-applying" class="selfRef">IPv4 + OPTIONS AFTER APPLYING ESP, OUTER IPv6 ADDRESSES</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="InnerIPv6">
<section id="section-4.4">
        <h3 id="name-inner-ipv6-datagram">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-inner-ipv6-datagram" class="section-name selfRef">Inner IPv6 Datagram</a>
        </h3>
<span id="name-ipv6-datagram-before-applyi"></span><div id="ipv6beforeesp">
<figure id="figure-7">
          <div class="alignLeft art-text artwork" id="section-4.4-1.1">
<pre>
    +--------------------------------------+
    |                |  ext   |     |      |
    | inner IPv6 hdr |  hdrs  | TCP | Data |
    +--------------------------------------r+-
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-ipv6-datagram-before-applyi" class="selfRef">IPv6 DATAGRAM BEFORE APPLYING ESP</a>
          </figcaption></figure>
</div>
<span id="name-ipv6-datagram-after-applyin"></span><div id="ipv6afterespipv6">
<figure id="figure-8">
          <div class="alignLeft art-text artwork" id="section-4.4-2.1">
<pre>
    +--------------------------------------------------------------+
    | outer    | new ext |     | ext  |     |      |  ESP    | ESP |
    | IPv6 hdr | hdrs.   | ESP | hdrs | TCP | Data | Trailer | ICV |
    +--------------------------------------------------------------+
                               |&lt;-------- encryption -------------&gt;|
                         |&lt;-------------- integrity --------------&gt;|
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-ipv6-datagram-after-applyin" class="selfRef">IPv6 DATAGRAM AFTER APPLYING ESP, OUTER IPv6 ADDRESSES</a>
          </figcaption></figure>
</div>
<span id="name-ipv6-datagram-after-applying"></span><div id="ipv6afterespipv4">
<figure id="figure-9">
          <div class="alignLeft art-text artwork" id="section-4.4-3.1">
<pre>
    ---------------------------------------------------
    | outer  |     | ext  |     |      |  ESP    | ESP |
    | IP hdr | ESP | hdrs.| TCP | Data | Trailer | ICV |
    ---------------------------------------------------
                   |&lt;------- encryption --------&gt;|
             |&lt;----------- integrity -----------&gt;|
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-ipv6-datagram-after-applying" class="selfRef">IPv6 DATAGRAM AFTER APPLYING ESP, OUTER IPv4 ADDRESSES</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="Cryptographic-processing">
<section id="section-5">
      <h2 id="name-cryptographic-processing">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-cryptographic-processing" class="section-name selfRef">Cryptographic processing</a>
      </h2>
<p id="section-5-1">
  The outgoing packets MUST be protected exactly as in ESP transport
   mode <span>[<a href="#RFC4303" class="cite xref">RFC4303</a>]</span>.  That is, the upper layer protocol packet is wrapped into
   an ESP header, encrypted, and authenticated exactly as if regular
   transport mode was used.  The resulting ESP packet is subject to IP
   header processing as defined in <a href="#IP-header-processing" class="auto internal xref">Section 6</a> and
  <a href="#Handling-of-outgoing" class="auto internal xref">Section 7</a>.  The incoming ESP protected messages
  are verified and decrypted exactly as if regular transport mode was used.
  The resulting cleartext packet is subject to IP header processing as
  defined in <a href="#IP-header-processing" class="auto internal xref">Section 6</a> and <a href="#Handling-of-incoming" class="auto internal xref">Section 8</a><a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IP-header-processing">
<section id="section-6">
      <h2 id="name-ip-header-processing">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-ip-header-processing" class="section-name selfRef">IP header processing</a>
      </h2>
<p id="section-6-1">
           The biggest difference between BEET mode and the other two modes
   lies in the way IP headers are processed.  In regular transport mode, the IP
   header is kept intact.  In the regular tunnel mode, an outer IP header
   is created on output and discarded on input.  In BEET mode, the IP
   header is replaced with another one on both input and output.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">
  On the BEET mode output side, the IP processing MUST first ensure that
  the IP addresses in the original IP header contain the inner addresses
  as specified in the SA. This MAY be ensured by proper policy processing,
  and it is possible that no checks are needed at the SA processing time.
  Once the IP header has been verified to contain the right IP inner
  addresses, it is discarded. A new IP header is derived, using the
  discarded inner header as a hint for other fields except the IP
  addresses, the IPv4 options, the IPv6 optional extensions,
 and the IPv4 fragmentation offset when the packet is a fragment.
 The IP addresses in the new header MUST be the outer tunnel addresses.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">

  On the input side, the received IP header is simply discarded. Since the
  packet has been decrypted and verified, no further checks are necessary.
  A new IP header, corresponding to a tunnel mode inner header, is derived,
  using the discarded outer header as a hint for other fields but the IP
  addresses, the IPv4 options, the IPv6 optional extensions, and the IPv4
  fragmentation offset when the packet is a fragment. The IP addresses in
  the new header MUST be the inner addresses negotiated.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">
   As the outer header fields are used as a hint for creating the inner
   header, it must be noted that the BEET inner header differs from
   tunnel mode inner headers. In BEET mode, an inner header will contain
   the TTL, DF-bit and other option values from the outer header. The
   TTL, DF-bit and other option values of the inner header MUST be
   processed by the stack. [AA would we loose the DF value?? if IPsec gateway has different policy?
  or is possible to restore the same as inner packet?]<a href="#section-6-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Handling-of-outgoing">
<section id="section-7">
      <h2 id="name-handling-of-outgoing-packet">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-handling-of-outgoing-packet" class="section-name selfRef">Handling of outgoing packets</a>
      </h2>
<p id="section-7-1">
           The outgoing BEET mode packets are processed as follows:<a href="#section-7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">
       The system MUST verify that the IP header contains the inner
       source and destination addresses, exactly as defined in the SA.
       This verification MAY be explicit, or it MAY be implicit, for
       example, as a result of prior policy processing.  Note that in
       some implementations there may be no real IP header at this time,
       but the source and destination addresses may be carried out-of-
       band. In case the source address is still unassigned, it SHOULD
       be ensured that the designated inner source address would be
       selected at a later stage.<a href="#section-7-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.2">
       The IP payload (the contents of the packet beyond the IP header)
       is wrapped into an ESP header as defined in <span>[<a href="#RFC4303" class="cite xref">RFC4303</a>]</span> Section 3.3.<a href="#section-7-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.3">
       A new IP header is constructed, replacing the original one.  The
       new IP header MUST contain the outer source and destination
       addresses, as defined in the SA.  Note that in some
       implementations there may be no real IP header at this time but
       the source and destination addresses may be carried out-of-band.
       In cases where the source address must be left unassigned, it
       SHOULD be ensured that the right source address is selected at
       a later stage. Other than the addresses, it is RECOMMENDED that
      the new IP header copies the fields from the original IP header,
      unless the packet is a IP fragment.<a href="#section-7-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.4">
    If there are any IPv4 options in the original packet, they are copied into
    ESP payload. The IPv4 options are tunneled between the tunnel end-points.
    The sender MUST encapsulate the options as defined in
    <a href="#IPv4-ph" class="auto internal xref">Section 9</a>.<a href="#section-7-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.5">
 If the packet is an IPv4 fragment, the flags and the fragment
     offset field from the inner IP packet MUST NOT be copied.
     Instead these two fields MUST be encapsulated with a PH
     header as defined in  <a href="#IPv4-ph" class="auto internal xref">Section 9</a>.<a href="#section-7-2.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-7-3">
   Instead of literally discarding the IP header and constructing a new one,
   a conforming implementation MAY simply replace the addresses in an
   existing header. However, if the RECOMMENDED feature of allowing the inner
   and outer addresses from different address families is used, this simple
   strategy does not work.<a href="#section-7-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Handling-of-incoming">
<section id="section-8">
      <h2 id="name-handling-of-incoming-packet">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-handling-of-incoming-packet" class="section-name selfRef">Handling of incoming packets</a>
      </h2>
<p id="section-8-1">
   The incoming BEET mode packets are processed as follows:<a href="#section-8-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-2">
        <li id="section-8-2.1">
      The system MUST successfully verify and decrypt the incoming packet, as
 specified in <span>[<a href="#RFC4303" class="cite xref">RFC4303</a>]</span> section 3.4.  If the verification
 or decryption fails, the packet MUST be discarded.<a href="#section-8-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-8-2.2">
 The original IP header is discarded without further verification since
 the ESP verification has already confirmed the packet's integrity and source.
  The packet can be safely assumed to have arrived from the right sender.<a href="#section-8-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-8-2.3">
        A new IP header is constructed, replacing the original one.  The
       new IP header MUST contain the inner source and destination
       addresses, as defined in the SA.  If the sender has set the ESP
       next protocol field to 94 and included the Pseudo-Header as
       described in <a href="#IPv4-ph" class="auto internal xref">Section 9</a>, the receiver MUST include the options
       after the constructed IP header.  Note, that in some
       implementations the real IP header may have already been
       discarded and the source and destination addresses are carried
       out-of-band.  In such case the out-of-band addresses MUST be the
       inner addresses.  Other than the addresses, it is RECOMMENDED
       that the new IP header copies the fields from the original IP
       header. [AA how about ESP in UDP and mapping changes?]<a href="#section-8-2.3" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-8-3">
 Alternatively, a conforming implementation MAY replace the addresses in an
  existing header rather than discarding it and creating a new one.
  However, if the RECOMMENDED feature of allowing
   the inner and outer addresses from different address families is
   used, this simple strategy does not work.<a href="#section-8-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IPv4-ph">
<section id="section-9">
      <h2 id="name-ipv4-pseudo-header">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-ipv4-pseudo-header" class="section-name selfRef">IPv4 Pseudo Header</a>
      </h2>
<p id="section-9-1">
   In BEET mode, if IPv4 options or IPv6 optional extensions are transported
  inside the tunnel, as ESP payload. For IPv4, the sender MUST include a
  Pseudo Header(PH) after ESP header.
  The pseudo-headerr indicates the IPv4 packet has options or the fragmentation
  flags and fragmentation offset is set.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">
   The sender MUST set the next protocol field on the ESP header as 94.
   The resulting pseudo header including the IPv4 options,  MUST be padded
   to 8 octet boundary.  The padding length is expressed in octets,
   valid padding lengths are 0 or 4 octets as the original IPv4 options
   are already padded to 4 octet boundary.  The padding MUST be filled
   with NOP options as defined in Internet Protocol <span>[<a href="#RFC791" class="cite xref">RFC791</a>]</span>
  section 3.1 Internet header format.  The padding is added in front of the
   original options to ensure that the receiver is able to reconstruct
   the original IPv4 datagram.  The Header Length field contains the
   length of the IPv4 options, and padding in 8 octets units.<a href="#section-9-2" class="pilcrow">¶</a></p>
<span id="name-beet-mode-pseudo-header-for"></span><div id="pseudoheader">
<figure id="figure-10">
        <div class="alignLeft art-text artwork" id="section-9-3.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Next Header  |   Header Len  |    Pad Len    |F = 2| Reserved|
   +---------------+---------------+-------------------------------+
   | IHF = 3 |Fragment offset (opt.) = 13 | PH padding             |
   +-----------------------------------------+---------------------+
   |                     IPv4 options (opt.) | Opt Padding         |
   +---------------------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-beet-mode-pseudo-header-for" class="selfRef">BEET mode pseudo header format</a>
        </figcaption></figure>
</div>
<ul class="normal">
<li class="normal" id="section-9-4.1">
          <p id="section-9-4.1.1">
 Next Header - Identifies the data following this header.<a href="#section-9-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-4.2">
          <p id="section-9-4.2.1">
 Header Len - 8-bit unsigned integer. Length of the pseudo header in
 8-octet units, including IHF and Fragment offset, IPv4 options, when present, not including the first 8 octets.<a href="#section-9-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-4.3">
          <p id="section-9-4.3.1">
 Pad Len - 8-bits unsigned integer. Length of padding in octets, valid padding lengths are:<a href="#section-9-4.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9-4.3.2.1">
              <p id="section-9-4.3.2.1.1">
 0, 4 : no IPv4 fragment and options are present [AA Note : old case]<a href="#section-9-4.3.2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9-4.3.2.2">
              <p id="section-9-4.3.2.2.1">
 2, 6 : IPv4 fragment and no IPv4 options.<a href="#section-9-4.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9-4.3.2.3">
              <p id="section-9-4.3.2.3.1">
 2, 6 : IPv4 fragment and options.<a href="#section-9-4.3.2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li class="normal" id="section-9-4.4">
          <p id="section-9-4.4.1">
 F - 2 bits Flags. 00 IP options, 01 Fragment, 10 IP options and Fragment, 11 Reserved<a href="#section-9-4.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-4.5">
          <p id="section-9-4.5.1">
 Reserved - Lower 6-bits, set to zero<a href="#section-9-4.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-4.6">
          <p id="section-9-4.6.1">
 IHF - Flags from the inner IP header (optional) when F = 01 or 10<a href="#section-9-4.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-4.7">
          <p id="section-9-4.7.1">
 Fragment offset 13 bits - Fragment offset from the inner IP header (optional) when F = 01 or 10<a href="#section-9-4.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-4.8">
          <p id="section-9-4.8.1">
 Padding - 0, 2 or 4 octets of zeros, depending on the fragment flag.<a href="#section-9-4.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-4.9">
          <p id="section-9-4.9.1">
 IPv4 options - IPv4 options from the inner IP header with optional padding. Alligned to 32 bits.<a href="#section-9-4.9.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-9-5"></p>
<p id="section-9-6">
  The receiver MUST remove this pseudo-header and padding as a part of BEET
  processing, in order to reconstruct the original IPv4 datagram. The IPv4
  options included in the pseudo-header MUST be added after the reconstructed
  IPv4 (inner) header on the receiving side. Also copy the flags and Fragment offset
 when the PH flags is 01, 10.<a href="#section-9-6" class="pilcrow">¶</a></p>
<p id="section-9-7">
  Note: when the IPv4 options are present, the outer header's IHL would be
  different from the inner header IHL.<a href="#section-9-7" class="pilcrow">¶</a></p>
<p id="section-9-8">
   The receiver MUST remove this pseudo-header and padding as a part of
   BEET processing, in order reconstruct the original IPv4 datagram.
   The IPv4 options included into the pseudo-header MUST be added after
   the reconstructed IPv4 (inner) header on the receiving side.<a href="#section-9-8" class="pilcrow">¶</a></p>
<p id="section-9-9">
  Note: When the pseudo-header is present due to the presence of IPv4 options
  in the inner IP header, the outer header's IHL (Internet Header Length) would
  be different from the inner IP header IHL.<a href="#section-9-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IPv4Frag">
<section id="section-10">
      <h2 id="name-ipv4-inner-fragments">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-ipv4-inner-fragments" class="section-name selfRef">IPv4 Inner Fragments</a>
      </h2>
<p id="section-10-1">
  When the inner IPv4 datagram is a fragment (as specified by the
  "more-fragments" flag being set to one <span>[<a href="#RFC791" class="cite xref">RFC791</a>]</span>), this flag
  MUST NOT be copied to the outer ESP datagram header. Additionally, for any
  non-first fragment with a "more-fragments" flag or "fragment offset field,"
  these two fields MUST NOT be copied to the outer IPv4 header of the ESP
  datagram.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">
  Here are a few possible ways to deal with these IPv4 fragments.<a href="#section-10-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-10-3">
        <li id="section-10-3.1">
    Re-assemble the IPv4 fragments, send to ESP, and ESP datagram may be
    fragmented as required.<a href="#section-10-3.1" class="pilcrow">¶</a>
</li>
        <li id="section-10-3.2">
    Drop the IPv4 fragments, i.e., BEET mode IPv4 support for fragments is
    optional.<a href="#section-10-3.2" class="pilcrow">¶</a>
</li>
        <li id="section-10-3.3">
    Copy the fragment flag and offset length from the inner IPv4 header to
    BEET pseudo-header <a href="#IPv4-ph" class="auto internal xref">Section 9</a>.<a href="#section-10-3.3" class="pilcrow">¶</a>
</li>
        <li id="section-10-3.4">
    Explore other solutions? [TBD?]<a href="#section-10-3.4" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-10-4"> TBD Discuss/Decide which of the above options make sense.<a href="#section-10-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IPv6Frag">
<section id="section-11">
      <h2 id="name-ipv6-inner-fragments">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-ipv6-inner-fragments" class="section-name selfRef">IPv6 inner Fragments</a>
      </h2>
<p id="section-11-1">
  It's crucial to highlight that IPv6 uses fragmentation information in a
  distinct manner than IPv4 <span>[<a href="#RFC8200" class="cite xref">RFC8200</a>]</span> Section 4.5.
  Specifically, an IPv6 fragment uses IPv6 optional extensions for
  fragments. BEET mode treats the IPv6 optional extensions as ESP payload and move from inner header to ESP payload.<a href="#section-11-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IPv4IPv6">
<section id="section-12">
      <h2 id="name-mixed-family-ipv4-inside-an">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-mixed-family-ipv4-inside-an" class="section-name selfRef">Mixed family IPv4 inside and IPv6 outside</a>
      </h2>
<p id="section-12-1">
    The inner datagram's IP version MUST be independent of the outer IP
    version. The inner address family and address are taken from the
    negotiated Traffic Selectors. When the inner datagram contains IPv4
    with fragments or IPv4 options, use <a href="#IPv4-ph" class="auto internal xref">Section 9</a>.<a href="#section-12-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IPv6IPv4">
<section id="section-13">
      <h2 id="name-mixed-family-ipv6-inside-an">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-mixed-family-ipv6-inside-an" class="section-name selfRef">Mixed family IPv6 inside and IPv4 outside</a>
      </h2>
<p id="section-13-1">
    When the inner datagram is an IPv6 datagram with IPv6 optional
    extensions, copy it into ESP payload <a href="#IPv6Frag" class="auto internal xref">Section 11</a>.<a href="#section-13-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Policy-Considerations">
<section id="section-14">
      <h2 id="name-policy-considerations">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-policy-considerations" class="section-name selfRef">Policy Considerations</a>
      </h2>
<p id="section-14-1">
  In this section we describe how BEET mode affects on IPsec policy
   processing.  This section is normative.<a href="#section-14-1" class="pilcrow">¶</a></p>
<p id="section-14-2">
   A BEET Security Association SHOULD NOT be used with NULL
   authentication.<a href="#section-14-2" class="pilcrow">¶</a></p>
<p id="section-14-3">
  On the output side, the IPsec policy processing mechanism SHOULD take
   care that only packets with IP addresses matching the inner
   addresses of a Security Association are passed on to that Security
   Association.  If the policy mechanism does not provide full assurance
   on this point, the SA processing MUST check the addresses.  Further policy
   distinction may be specified based on IP version, upper layer
   protocol, and ports.  If such restrictions are defined, they MUST be
   enforced.<a href="#section-14-3" class="pilcrow">¶</a></p>
<p id="section-14-4">
  On the output side, the policy rules SHOULD prevent any packets
   containing the pair of inner IP addresses from escaping to the wire in
   cleartext.<a href="#section-14-4" class="pilcrow">¶</a></p>
<p id="section-14-5">
  On the input side,no policy processing is necessary for
   encrypted packets.  The SA is deduced from the SPI and destination
   address.  A single SA MAY be associated with several outter destination
   addresses.  Since the outer IPsec addresses are discarded, and since
   the packet authenticity and integrity are protected by ESP, there is
   no need to check the outer addresses.  Since the inner addresses are
   fixed and restored from the SA, there is no need to check them.
   There MAY be further policy rules specifying allowed upper layer
   protocols and ports. If such restrictions are defined, they MUST be
   enforced.<a href="#section-14-5" class="pilcrow">¶</a></p>
<p id="section-14-6">
  On the input side, there SHOULD be a policy rule that filters out
   cleartext packets that contain the inner addresses.<a href="#section-14-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-15">
      <h2 id="name-security-considerations">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-15-1"> In this section we discuss the security properties of the BEET mode,
   discussing some and point out some of its limitations <span>[<a href="#RFC3552" class="cite xref">RFC3552</a>]</span>.<a href="#section-15-1" class="pilcrow">¶</a></p>
<p id="section-15-2">There are no known new vulnerabilities that the introduction of the
   BEET mode would create.<a href="#section-15-2" class="pilcrow">¶</a></p>
<p id="section-15-3">
   It is currently possible to implement the equivalent of BEET mode by
   using transport mode ESP and explicit network address translation at
   the end-hosts themselves.  However, such an implementation is more
   complex, less flexible, and potentially more vulnerable to security
   problems that are caused by misconfigurations; see Section 9.<a href="#section-15-3" class="pilcrow">¶</a></p>
<p id="section-15-4">
   The main security benefit is an operational one.  To implement the
   same functionality without BEET mode typically requires
   configuring three different, unrelated components in the hosts.<a href="#section-15-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-15-5.1"> The transport mode ESP SAs must be configured.<a href="#section-15-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-15-5.2"> A host-based NAT function must be configured to properly translate
      between the inner and outer addresses.<a href="#section-15-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-15-5.3"> A host firewall must be configured to properly filter out packets
      so that inner addresses do not leak in or out.<a href="#section-15-5.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-15-6">
   While it may be possible to configure these components to achieve the
   same functionality, such a configuration is error prone, increasing
   the probability of security vulnerabilities.  An integrated BEET mode
   implementation is less prone to configuration mistakes.  Furthermore,
   it would be fairly hard to implement portable key management
   protocols that would be able to configure all of the required
   components at the same time.  On the other hand, it would be easy to
   provide a portable key management protocol implementation that would
   be able to configure BEET mode SAs through the specified PF_KEY
   extensions.<a href="#section-15-6" class="pilcrow">¶</a></p>
<p id="section-15-7">
   Since the BEET security associations have the semantics of a fixed,
   point-to-point tunnel between two IP addresses, it is possible to
   place one or both of the tunnel end0points into other nodes but those
   that actually "possess" the inner IP addresses, i.e., to implement a
   BEET mode proxy.  However, since such usage defeats the security
   benefits of combined ESP and hostNAT processing, as discussed above,
   the implementations SHOULD NOT support such usage.<a href="#section-15-7" class="pilcrow">¶</a></p>
<p id="section-15-8">
   Because in BEET mode the outer header source address is not checked at
   the time of input handling, there is a potential for a DoS attack
   where the attacker would send random packets that match the SPI of
   some BEET-mode SA. This kind of attack would cause the victim to
   perform unnecessary integrity checks that would result in a failure.
   However, if this kind of behavior is detected, the node may request rekeying
   using IKEv2 rekey, and after rekeying. If the attacker
   was not on the path, the new SPI value would not be known by the
   attacker.<a href="#section-15-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IKENegotiation">
<section id="section-16">
      <h2 id="name-ikev2-negotiation">
<a href="#section-16" class="section-number selfRef">16. </a><a href="#name-ikev2-negotiation" class="section-name selfRef">IKEv2 Negotiation</a>
      </h2>
<p id="section-16-1">
 When negotiating a Child SA using using IKEv2, the initiator may use
      the new "USE_BEET_MODE" Notify Message to request a Child SA pair with
      BEET mode support.  The method used is similar to how USE_TRANSPORT_MODE
 is negotiated, as described in <span>[<a href="#RFC7296" class="cite xref">RFC7296</a>]</span><a href="#section-16-1" class="pilcrow">¶</a></p>
<p id="section-16-2">
      To request a BEET-mode SA on the Child SA pair, the initiator MUST
      include the USE_BEET_MODE Notify Message when requesting a new Child
 SA, either during the IKE_AUTH or CREATE_CHILD_SA exchanges.
 If the request is accepted, the response MUST also include a USE_BEET_MODE
 notification. If the responder declines and does not include the
 USE_BEET_MODE notification in the response, the child SA will be
 established without BEET mode enabled. If this is unacceptable to the
 initiator, the initiator MUST delete the child SA.<a href="#section-16-2" class="pilcrow">¶</a></p>
<div id="USEBeetNotify">
<section id="section-16.1">
        <h3 id="name-use_beet_mode-notify-messag">
<a href="#section-16.1" class="section-number selfRef">16.1. </a><a href="#name-use_beet_mode-notify-messag" class="section-name selfRef">USE_BEET_MODE Notify Message Payload</a>
        </h3>
<figure id="figure-11">
          <div class="alignLeft art-text artwork" id="section-16.1-1.1">
<pre>
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-----------------------------+-------------------------------+
! Next Payload  !C!  RESERVED   !         Payload Length        !
+---------------+---------------+-------------------------------+
!  Protocol ID  !   SPI Size    !      Notify Message Type      !
+---------------+---------------+-------------------------------+
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a></figcaption></figure>
<ul class="normal">
<li class="normal" id="section-16.1-2.1">Payload Length - MUST be 0.<a href="#section-16.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-16.1-2.2">Protocol ID (1 octet) - MUST be 0. MUST be ignored if not 0.<a href="#section-16.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-16.1-2.3">SPI Size (1 octet) - MUST be 0. MUST be ignored if not 0.<a href="#section-16.1-2.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="IANA">
<section id="section-17">
      <h2 id="name-iana-considerations">
<a href="#section-17" class="section-number selfRef">17. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-17-1">
        This document defines a new IKEv2 Notify Message Type payloads for the IANA "IKEv2 Notify Message Types - Status Types" registry.<a href="#section-17-1" class="pilcrow">¶</a></p>
<div id="iana_requests_i">
<figure id="figure-12">
        <div class="alignLeft art-text artwork" id="section-17-2.1">
<pre>
      Value   Notify Type Messages - Status Types    Reference
      -----   ------------------------------    ---------------
      [TBD1]   USE_BEET_MODE                      [this document]
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a></figcaption></figure>
</div>
</section>
</div>
<div id="Implementation">
<section id="section-18">
      <h2 id="name-implementation-status">
<a href="#section-18" class="section-number selfRef">18. </a><a href="#name-implementation-status" class="section-name selfRef">Implementation Status</a>
      </h2>
<p id="section-18-1">
  [Note to RFC Editor: Please remove this section and the reference to
      <span>[<a href="#RFC6982" class="cite xref">RFC6982</a>]</span> before publication.]<a href="#section-18-1" class="pilcrow">¶</a></p>
<p id="section-18-2">
      This section records the status of known implementations of the
      protocol defined by this specification at the time of posting of
      this Internet-Draft, and is based on a proposal described in
      <span>[<a href="#RFC7942" class="cite xref">RFC7942</a>]</span>. The description of implementations in this
      section is intended to assist the IETF in its decision processes
      in progressing drafts to RFCs. Please note that the listing of
      any individual implementation here does not imply endorsement
      by the IETF. Furthermore, no effort has been spent to verify the
      information presented here that was supplied by IETF contributors.
      This is not intended as, and must not be construed to be, a catalog
      of available implementations or their features. Readers are advised
      to note that other implementations may exist.<a href="#section-18-2" class="pilcrow">¶</a></p>
<p id="section-18-3">
      According to <span>[<a href="#RFC7942" class="cite xref">RFC7942</a>]</span>, "this will allow reviewers
      and working groups to assign due consideration to documents that
      have the benefit of running code, which may serve as evidence of
      valuable experimentation and feedback that have made the implemented
      protocols more mature.  It is up to the individual working groups
      to use this information as they see fit".<a href="#section-18-3" class="pilcrow">¶</a></p>
<p id="section-18-4">
      Authors are requested to add a note to the RFC Editor at the
      top of this section, advising the Editor to remove the entire
      section before publication, as well as the reference to <span>[<a href="#RFC7942" class="cite xref">RFC7942</a>]</span>.<a href="#section-18-4" class="pilcrow">¶</a></p>
<div id="impl-status.Linux.xfrm">
<section id="section-18.1">
        <h3 id="name-linux-xfrm">
<a href="#section-18.1" class="section-number selfRef">18.1. </a><a href="#name-linux-xfrm" class="section-name selfRef">Linux XFRM</a>
        </h3>
<p id="section-18.1-1"> Linux<a href="#section-18.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-18.1-2">
          <dt id="section-18.1-2.1"> Organization: </dt>
          <dd style="margin-left: 1.5em" id="section-18.1-2.2"> Linux kernel Project<a href="#section-18.1-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.3"> Name: </dt>
          <dd style="margin-left: 1.5em" id="section-18.1-2.4"> Linux Kernel  https://www.kernel.org/<a href="#section-18.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.5"> Description: </dt>
          <dd style="margin-left: 1.5em" id="section-18.1-2.6"> Implements BEET mode in ESP. The initial support was added in 2006. It is widely used<a href="#section-18.1-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.7"> Level of maturity: </dt>
          <dd style="margin-left: 1.5em" id="section-18.1-2.8"> Stable used for over 15 years<a href="#section-18.1-2.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.9"> Licensing: </dt>
          <dd style="margin-left: 1.5em" id="section-18.1-2.10"> GPLv2<a href="#section-18.1-2.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.11"> Implementation experience: </dt>
          <dd style="margin-left: 1.5em" id="section-18.1-2.12"> There is no support for IPv4 fragments yet. IPv6 fragments
 appears to work. The BEE mode code is in production for over a decade<a href="#section-18.1-2.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.1-2.13"> Contact: </dt>
          <dd style="margin-left: 1.5em" id="section-18.1-2.14"> https://lore.kernel.org/netdev/<a href="#section-18.1-2.14" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="section.impl-status.strongswan">
<section id="section-18.2">
        <h3 id="name-strongswan">
<a href="#section-18.2" class="section-number selfRef">18.2. </a><a href="#name-strongswan" class="section-name selfRef">strongSwan</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-18.2-1">
          <dt id="section-18.2-1.1"> Organization: </dt>
          <dd style="margin-left: 1.5em" id="section-18.2-1.2"> The strongSwan Project<a href="#section-18.2-1.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.2-1.3"> Name: </dt>
          <dd style="margin-left: 1.5em" id="section-18.2-1.4"> strongSwan https://docs.strongswan.org/docs/5.9/swanctl/swanctlConf.html<a href="#section-18.2-1.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.2-1.5"> Description: </dt>
          <dd style="margin-left: 1.5em" id="section-18.2-1.6"> Implement IKE negotiation and and ESP support for BEET mode Linux.<a href="#section-18.2-1.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.2-1.7"> Level of maturity: </dt>
          <dd style="margin-left: 1.5em" id="section-18.2-1.8"> Stable<a href="#section-18.2-1.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.2-1.9"> Coverage: </dt>
          <dd style="margin-left: 1.5em" id="section-18.2-1.10"> Implements negotiating BEET mode support in Child SA negotiations
 and using it in ESP. The initial support was added in 2006.<a href="#section-18.2-1.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.2-1.11"> Licensing: </dt>
          <dd style="margin-left: 1.5em" id="section-18.2-1.12"> GPLv2<a href="#section-18.2-1.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.2-1.13"> Implementation experience </dt>
          <dd style="margin-left: 1.5em" id="section-18.2-1.14">
             strongSwan use a private space notification value for IKE
  negotiation.  USE_BEET_MODE (40961). As far we know BEET is widely used.<a href="#section-18.2-1.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.2-1.15"> Contact </dt>
          <dd style="margin-left: 1.5em" id="section-18.2-1.16">Tobias Brunner tobias@strongswan.org<a href="#section-18.2-1.16" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="section.impl-status.iproute2">
<section id="section-18.3">
        <h3 id="name-iproute2">
<a href="#section-18.3" class="section-number selfRef">18.3. </a><a href="#name-iproute2" class="section-name selfRef">iproute2</a>
        </h3>
<span class="break"></span><dl class="dlParallel" id="section-18.3-1">
          <dt id="section-18.3-1.1"> Organization: </dt>
          <dd style="margin-left: 1.5em" id="section-18.3-1.2"> The iproute2 Project<a href="#section-18.3-1.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.3-1.3"> Name: </dt>
          <dd style="margin-left: 1.5em" id="section-18.3-1.4"> iproute2 https://git.kernel.org/pub/scm/network/iproute2/iproute2.git<a href="#section-18.3-1.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.3-1.5"> Description: </dt>
          <dd style="margin-left: 1.5em" id="section-18.3-1.6"> Implements BEET mode support in ESP. e.g. command support "ip xfrm policy ... mode beet" . and "ip xfrm state .. mode beet". The initial support was added in 2006<a href="#section-18.3-1.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.3-1.7"> Level of maturity: </dt>
          <dd style="margin-left: 1.5em" id="section-18.3-1.8"> Stable<a href="#section-18.3-1.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.3-1.9"> Licensing: </dt>
          <dd style="margin-left: 1.5em" id="section-18.3-1.10"> GPLv2<a href="#section-18.3-1.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.3-1.11"> Implementation experience: </dt>
          <dd style="margin-left: 1.5em" id="section-18.3-1.12"> TBD<a href="#section-18.3-1.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-18.3-1.13"> Contact: </dt>
          <dd style="margin-left: 1.5em" id="section-18.3-1.14"> https://lore.kernel.org/netdev/ or Stephen Hemminger stephen@networkplumber.org<a href="#section-18.3-1.14" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="Acknowledgements">
<section id="section-19">
      <h2 id="name-acknowledgments">
<a href="#section-19" class="section-number selfRef">19. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-19-1">
    We sincerely thank the previous authors and contributors whose work laid the
  foundation for this document. Their insights and dedication have greatly
  influenced our work, also their contributions to the BEET mode
  implementation many years ago.<a href="#section-19-1" class="pilcrow">¶</a></p>
<p id="section-19-2">
    Special thanks to Peka Nikander for generously granting permission to use
 their previous work <span>[<a href="#I-D.nikander-esp-beet-mode" class="cite xref">I-D.nikander-esp-beet-mode</a>]</span>.<a href="#section-19-2" class="pilcrow">¶</a></p>
<p id="section-19-3">
    We appreciate the guidance and support from Tero Kivinen in reaching out to
 previous authors during the document's development.<a href="#section-19-3" class="pilcrow">¶</a></p>
<p id="section-19-4">
    Our gratitude also goes to all those who provided feedback, guidance, and
 support throughout this document's development and operational experience.
 Your contributions were vital in making this work possible.<a href="#section-19-4" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-20">
      <h2 id="name-normative-references">
<a href="#section-20" class="section-number selfRef">20. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4301">[RFC4301]</dt>
      <dd>
<span class="refAuthor">Kent, S.</span> and <span class="refAuthor">K. Seo</span>, <span class="refTitle">"Security Architecture for the Internet Protocol"</span>, <span class="seriesInfo">RFC 4301</span>, <span class="seriesInfo">DOI 10.17487/RFC4301</span>, <time datetime="2005-12" class="refDate">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4301">https://www.rfc-editor.org/info/rfc4301</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4303">[RFC4303]</dt>
      <dd>
<span class="refAuthor">Kent, S.</span>, <span class="refTitle">"IP Encapsulating Security Payload (ESP)"</span>, <span class="seriesInfo">RFC 4303</span>, <span class="seriesInfo">DOI 10.17487/RFC4303</span>, <time datetime="2005-12" class="refDate">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4303">https://www.rfc-editor.org/info/rfc4303</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
      <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Eronen, P.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time datetime="2014-10" class="refDate">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC791">[RFC791]</dt>
      <dd>
<span class="refAuthor">Postel, J.</span>, <span class="refTitle">"Internet Protocol"</span>, <span class="seriesInfo">STD 5</span>, <span class="seriesInfo">RFC 791</span>, <span class="seriesInfo">DOI 10.17487/RFC0791</span>, <time datetime="1981-09" class="refDate">September 1981</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc791">https://www.rfc-editor.org/info/rfc791</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8200">[RFC8200]</dt>
    <dd>
<span class="refAuthor">Deering, S.</span> and <span class="refAuthor">R. Hinden</span>, <span class="refTitle">"Internet Protocol, Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 86</span>, <span class="seriesInfo">RFC 8200</span>, <span class="seriesInfo">DOI 10.17487/RFC8200</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8200">https://www.rfc-editor.org/info/rfc8200</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-21">
      <h2 id="name-informative-references">
<a href="#section-21" class="section-number selfRef">21. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
      </h2>
<dl class="references">
<dt id="I-D.nikander-esp-beet-mode">[I-D.nikander-esp-beet-mode]</dt>
      <dd>
<span class="refAuthor">Nikander, P.</span> and <span class="refAuthor">J. Melen</span>, <span class="refTitle">"A Bound End-to-End Tunnel (BEET) mode for ESP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-nikander-esp-beet-mode-09</span>, <time datetime="2008-08-05" class="refDate">5 August 2008</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-nikander-esp-beet-mode-09">https://datatracker.ietf.org/doc/html/draft-nikander-esp-beet-mode-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3552">[RFC3552]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span> and <span class="refAuthor">B. Korver</span>, <span class="refTitle">"Guidelines for Writing RFC Text on Security Considerations"</span>, <span class="seriesInfo">BCP 72</span>, <span class="seriesInfo">RFC 3552</span>, <span class="seriesInfo">DOI 10.17487/RFC3552</span>, <time datetime="2003-07" class="refDate">July 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3552">https://www.rfc-editor.org/info/rfc3552</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5201">[RFC5201]</dt>
      <dd>
<span class="refAuthor">Moskowitz, R.</span>, <span class="refAuthor">Nikander, P.</span>, <span class="refAuthor">Jokela, P., Ed.</span>, and <span class="refAuthor">T. Henderson</span>, <span class="refTitle">"Host Identity Protocol"</span>, <span class="seriesInfo">RFC 5201</span>, <span class="seriesInfo">DOI 10.17487/RFC5201</span>, <time datetime="2008-04" class="refDate">April 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5201">https://www.rfc-editor.org/info/rfc5201</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5202">[RFC5202]</dt>
      <dd>
<span class="refAuthor">Jokela, P.</span>, <span class="refAuthor">Moskowitz, R.</span>, and <span class="refAuthor">P. Nikander</span>, <span class="refTitle">"Using the Encapsulating Security Payload (ESP) Transport Format with the Host Identity Protocol (HIP)"</span>, <span class="seriesInfo">RFC 5202</span>, <span class="seriesInfo">DOI 10.17487/RFC5202</span>, <time datetime="2008-04" class="refDate">April 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5202">https://www.rfc-editor.org/info/rfc5202</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6982">[RFC6982]</dt>
      <dd>
<span class="refAuthor">Sheffer, Y.</span> and <span class="refAuthor">A. Farrel</span>, <span class="refTitle">"Improving Awareness of Running Code: The Implementation Status Section"</span>, <span class="seriesInfo">RFC 6982</span>, <span class="seriesInfo">DOI 10.17487/RFC6982</span>, <time datetime="2013-07" class="refDate">July 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6982">https://www.rfc-editor.org/info/rfc6982</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7401">[RFC7401]</dt>
      <dd>
<span class="refAuthor">Moskowitz, R., Ed.</span>, <span class="refAuthor">Heer, T.</span>, <span class="refAuthor">Jokela, P.</span>, and <span class="refAuthor">T. Henderson</span>, <span class="refTitle">"Host Identity Protocol Version 2 (HIPv2)"</span>, <span class="seriesInfo">RFC 7401</span>, <span class="seriesInfo">DOI 10.17487/RFC7401</span>, <time datetime="2015-04" class="refDate">April 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7401">https://www.rfc-editor.org/info/rfc7401</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7402">[RFC7402]</dt>
      <dd>
<span class="refAuthor">Jokela, P.</span>, <span class="refAuthor">Moskowitz, R.</span>, and <span class="refAuthor">J. Melen</span>, <span class="refTitle">"Using the Encapsulating Security Payload (ESP) Transport Format with the Host Identity Protocol (HIP)"</span>, <span class="seriesInfo">RFC 7402</span>, <span class="seriesInfo">DOI 10.17487/RFC7402</span>, <time datetime="2015-04" class="refDate">April 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7402">https://www.rfc-editor.org/info/rfc7402</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7942">[RFC7942]</dt>
      <dd>
<span class="refAuthor">Sheffer, Y.</span> and <span class="refAuthor">A. Farrel</span>, <span class="refTitle">"Improving Awareness of Running Code: The Implementation Status Section"</span>, <span class="seriesInfo">BCP 205</span>, <span class="seriesInfo">RFC 7942</span>, <span class="seriesInfo">DOI 10.17487/RFC7942</span>, <time datetime="2016-07" class="refDate">July 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7942">https://www.rfc-editor.org/info/rfc7942</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9333">[RFC9333]</dt>
    <dd>
<span class="refAuthor">Migault, D.</span> and <span class="refAuthor">T. Guggemos</span>, <span class="refTitle">"Minimal IP Encapsulating Security Payload (ESP)"</span>, <span class="seriesInfo">RFC 9333</span>, <span class="seriesInfo">DOI 10.17487/RFC9333</span>, <time datetime="2023-01" class="refDate">January 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9333">https://www.rfc-editor.org/info/rfc9333</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="app-additional">
<section id="appendix-A">
      <h2 id="name-additional-stuff">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-additional-stuff" class="section-name selfRef">Additional Stuff</a>
      </h2>
<p id="appendix-A-1">This becomes an Appendix.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Antony Antony</span></div>
<div dir="auto" class="left"><span class="org">secunet Security Networks AG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:antony.antony@secunet.com" class="email">antony.antony@secunet.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Steffen Klassert</span></div>
<div dir="auto" class="left"><span class="org">secunet Security Networks AG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:steffen.klassert@secunet.com" class="email">steffen.klassert@secunet.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
<script>(function(){if (!document.body) return;var js = "window['__CF$cv$params']={r:'87c0b65a9e700e6c',t:'MTcxNDQwODYwMC45MjAwMDA='};_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js',document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script></body>
</html>
